---
output:  github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# tidygedcom

<!-- badges: start -->
[![R-CMD-check](https://github.com/jl5000/tidygedcom/workflows/R-CMD-check/badge.svg)](https://github.com/jl5000/tidygedcom/actions)
[![](https://codecov.io/gh/jl5000/tidygedcom/branch/master/graph/badge.svg)](https://codecov.io/gh/jl5000/tidygedcom)
[![CodeFactor](https://www.codefactor.io/repository/github/jl5000/tidygedcom/badge)](https://www.codefactor.io/repository/github/jl5000/tidygedcom)
[![](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
<!-- badges: end -->

> Families can be difficult - but the data describing them doesn't need to be

Import, create, and summarise family tree GEDCOM files using tidy dataframes. This package is still in heavy development with the first operational version likely around March 2021.

## Installation

You can install development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("jl5000/tidygedcom")
```

## Example

The intent is to allow the user to import GEDCOM files or create them from scratch using a `ggplot2` type interface; starting with a base GEDCOM object (with only a header and trailer section) and adding records as you would add layers to a ggplot object (but instead using the pipe operator, %>%).

An example is below:

```{r example}
library(tidygedcom)

tg <- gedcom(subm("Jamie Lendrum"), gedcom_description = "The Skywalker family", gedcom_copyright = "None") %>%
  add_individual(sex = "M", individual_notes = "The central character in the Star Wars Skywalker Saga") %>%
  add_individual_names("Anakin Skywalker", type = "birth", given = "Anakin", surname = "Skywalker") %>%
  add_individual_names("Darth Vader", type = "given", given = "Darth Vader") %>%
  add_individual(sex = "F", individual_notes = "Queen of Naboo") %>%
  add_individual_names("Padme Amidala", given = "Padme", surname = "Amidala") %>% 
  add_individual(sex = "F") %>% 
  add_individual_names("Leia Skywalker", type = "birth", given = "Leia", surname = "Skywalker") %>%
  add_individual_names("Princess Leia Organa", type = "adoptive", 
                       prefix = "Princess", given = "Leia", surname = "Organa") %>% 
  add_individual(sex = "M") %>%
  add_individual_names("Luke Skywalker", type = "birth", given = "Luke", surname = "Skywalker") %>% 
  add_individual(sex = "M") %>% 
  add_individual_names("Obi-Wan Kenobi", type = "birth", given = "Obi-Wan", 
                       nickname = "Ben", surname = "Kenobi") %>% 
  add_family_group(husband = "Anakin", wife = "Padme", children = c("Luke", "Leia")) %>%
  activate_individual_record("Anakin") %>% 
  add_individual_association("Obi-Wan", association = "Master") %>% 
  add_individual_event_death(age_at_event = "45y", event_cause = "Killed by son Luke",
                             place_name = "Second Death Star", place_notes = "Orbiting Endor System") %>% 
  add_individual_attribute_religion(attribute_descriptor = "Jedi") %>% 
  add_individual_attribute_possessions(attribute_descriptor = "Lightsaber") %>%
  add_note("Based on Star Wars") %>% 
  add_source(short_title = "Star Wars", title = "Star Wars Episode IV: A New Hope") %>% 
  add_repository("The Skywalker Saga") %>% 
  add_multimedia(file_reference = "XYZ", format = "JPG")

print(tg, n = Inf)
```


Just like a ggplot object requires aesthetics, a GEDCOM file requires details of a submitter. If no submitter details are given, the username is used.

Within the package, GEDCOM files are represented as a sub-class of tibble known as `tidygedcom` objects, allowing easy manipulation and exploitation of existing `tidyverse` infrastructure.

A number of functions are available to provide summaries of `tidygedcom` objects:

```{r}
num_indi(tg)
num_fam(tg)

str(tg)
summary(tg)

df_individuals(tg) %>% print(n = Inf, width = Inf)
df_families(tg) %>% print(n = Inf, width = Inf)
```

This package allows limited editing of `tidygedcom` objects (adding/removing records, as well as the addition of some record substructures). Editing of existing records is made possible through 'activation' (much like the `tidygraph` package). When a record is created, it automatically becomes the active record, through an object attribute. Record editing functions then act on this record. Other records can be activated through a series of `activate_*_record()` functions.

## Current status

The package and its internal data structures (contained in a separate `tidygedcom.internals` package) are almost complete and will soon be submitted to CRAN.

Three further packages are also planned, to provide an ecosystem called the `gedcompendium`:

* `shinygedcom` will provide a shiny app to edit `tidygedcom` objects;
* `visgedcom` will allow visualisation of `tidygedcom` objects;
* `tidygedcom.sources` will provide functions to automate the representation of facts from various source documents (e.g. birth certificates, censuses).

## References

* [The GEDCOM 5.5.5 Specification](https://www.gedcom.org/gedcom.html)
