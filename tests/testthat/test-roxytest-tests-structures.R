# Generated by roxytest: Do not edit by hand!

context("File R/structures.R: @tests")

test_that("Function ADDRESS_STRUCTURE() @ L52", {
  expect_error(ADDRESS_STRUCTURE())
  expect_error(ADDRESS_STRUCTURE(letters[1:5]))
  expect_error(ADDRESS_STRUCTURE("address", address_city = 1:2))
  expect_error(ADDRESS_STRUCTURE("address", address_state = 1:2))
  expect_error(ADDRESS_STRUCTURE("address", address_postal_code = 1:2))
  expect_error(ADDRESS_STRUCTURE("address", phone_number = 1:4))
  expect_error(ADDRESS_STRUCTURE("address", address_email = 1:4))
  expect_error(ADDRESS_STRUCTURE("address", address_fax = 1:4))
  expect_error(ADDRESS_STRUCTURE("address", address_web_page = 1:4))
  expect_error(ADDRESS_STRUCTURE(paste0(rep("a", 61), collapse = "")))
  expect_error(ADDRESS_STRUCTURE("address", address_city = paste0(rep("a", 61), collapse = "")))
  expect_error(ADDRESS_STRUCTURE("address", address_state = paste0(rep("a", 61), collapse = "")))
  expect_error(ADDRESS_STRUCTURE("address", address_postal_code = paste0(rep("a", 11), collapse = "")))
  expect_error(ADDRESS_STRUCTURE("address", address_country = paste0(rep("a", 61), collapse = "")))
  expect_error(ADDRESS_STRUCTURE("address", address_web_page = paste0(rep("a", 121), collapse = "")))
  
  expect_equal(ADDRESS_STRUCTURE("Road name"),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "ADDR", "Road name"
               ))
  
  expect_equal(ADDRESS_STRUCTURE(letters[1:4]),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "ADDR",    "a",
                               1, "CONT",    "b",
                               1, "CONT",    "c",
                               1, "CONT",    "d",
                               1, "ADR1",    "b",
                               1, "ADR2",    "c",
                               1, "ADR3",    "d"
               ))
  
  expect_equal(ADDRESS_STRUCTURE(letters[1:2], address_country = "UK"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "ADDR",    "a",
                               1, "CONT",    "b",
                               1, "ADR1",    "b",
                               1, "CTRY",   "UK"
               ))
})


test_that("Function ASSOCIATION_STRUCTURE() @ L149", {
  expect_error(ASSOCIATION_STRUCTURE())
  expect_error(ASSOCIATION_STRUCTURE("@1@"))
  expect_error(ASSOCIATION_STRUCTURE(c("@1@", "@2@"), "Godfather"))
  
  expect_equal(ASSOCIATION_STRUCTURE("@I1@", "Godfather"),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "ASSO",      "@I1@",
                               1, "RELA", "Godfather"
               ))
  
  expect_equal(ASSOCIATION_STRUCTURE("@I1@", "Father", 
                                     notes = list(NOTE_STRUCTURE(submitter_text = "This is a note"))), 
               tibble::tribble(~level,   ~tag,              ~value,
                               0, "ASSO",              "@I1@",
                               1, "RELA",            "Father",
                               1, "NOTE",    "This is a note"
               ))
})


test_that("Function CHANGE_DATE() @ L207", {
  expect_equal(CHANGE_DATE(),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "CHAN", "",
                               1, "DATE", toupper(format(Sys.Date(), "%d %b %Y"))
               ))
                               
  expect_equal(CHANGE_DATE(date_exact(5, 10, 1990)),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "CHAN", "",
                               1, "DATE", "5 OCT 1990"
               ))
                               
  expect_equal(CHANGE_DATE(date_exact(18, 12, 2008), time_value = "11:00:08.563"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "CHAN", "",
                               1, "DATE", "18 DEC 2008",
                               2, "TIME", "11:00:08.563"
               ))
                               
  expect_equal(CHANGE_DATE(date_exact(5, 10, 1990), "10:34:56", 
                           notes = list(NOTE_STRUCTURE(submitter_text = "Note 1"),
                                        NOTE_STRUCTURE(submitter_text = "Note 2"))),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "CHAN", "",
                               1, "DATE", "5 OCT 1990",
                               2, "TIME", "10:34:56",
                               1, "NOTE", "Note 1",
                               1, "NOTE", "Note 2"
               ))
})


test_that("Function CHILD_TO_FAMILY_LINK() @ L250", {
  expect_error(CHILD_TO_FAMILY_LINK())
  expect_error(CHILD_TO_FAMILY_LINK("@1@", pedigree_linkage_type = "foste"))
  expect_error(CHILD_TO_FAMILY_LINK("@1@", child_linkage_status = "challenge"))
  
  expect_equal(CHILD_TO_FAMILY_LINK("@F1@"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "FAMC", "@F1@"
               ))
  
  expect_equal(CHILD_TO_FAMILY_LINK("@F1@", "birth", "proven"),
               tibble::tribble(~level,   ~tag,   ~value,
                               0, "FAMC",   "@F1@",
                               1, "PEDI",  "birth",
                               1, "STAT", "proven"
               ))
})


test_that("Function EVENT_DETAIL() @ L308", {
  expect_error(EVENT_DETAIL(restriction_notice = "something"))
  expect_equal(dim(EVENT_DETAIL()), c(0, 3))
  
  expect_equal(EVENT_DETAIL(event_or_fact_classification = "Woodworking"),
               tibble::tribble(~level,   ~tag,        ~value,
                               0, "TYPE", "Woodworking"
               ))
  
  expect_equal(EVENT_DETAIL(place = PLACE_STRUCTURE("Somewhere")),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "PLAC", "Somewhere"
               ))
  
  expect_equal(EVENT_DETAIL(place = PLACE_STRUCTURE("Somewhere"), 
                            date = date_value(2008, 4, 9, about = TRUE)),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "DATE", "ABT 9 APR 2008",
                               0, "PLAC", "Somewhere"
               ))
  
  expect_equal(EVENT_DETAIL(address = ADDRESS_STRUCTURE(c("House name", "Road"))),
               tibble::tribble(~level,   ~tag,       ~value,
                               0, "ADDR", "House name",
                               1, "CONT",       "Road",
                               1, "ADR1",       "Road"
               ))
})


test_that("Function FAMILY_EVENT_DETAIL() @ L374", {
  expect_equal(dim(FAMILY_EVENT_DETAIL()), c(0, 3))  
  
  expect_equal(FAMILY_EVENT_DETAIL(husband_age_at_event = "42y"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "HUSB",     "",
                               1,  "AGE",   "42y"
               ))
  
  expect_equal(FAMILY_EVENT_DETAIL(wife_age_at_event = "40y"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "WIFE",     "",
                               1,  "AGE",   "40y"
               ))
  
  expect_equal(FAMILY_EVENT_DETAIL(husband_age_at_event = "42y", wife_age_at_event = "40y"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "HUSB",     "",
                               1,  "AGE",   "42y",
                               0, "WIFE",     "",
                               1,  "AGE",   "40y"
               ))
})


test_that("Function FAMILY_EVENT_STRUCTURE() @ L435", {
  expect_error(FAMILY_EVENT_STRUCTURE())
  expect_error(FAMILY_EVENT_STRUCTURE("TEST"))
  
  expect_equal(FAMILY_EVENT_STRUCTURE("CENS"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "CENS",     ""
               ))
  
  expect_equal(FAMILY_EVENT_STRUCTURE("EVEN"), 
               tibble::tribble(~level,   ~tag, ~value,
                               0, "EVEN",     ""
               ))
  
  expect_equal(FAMILY_EVENT_STRUCTURE("EVEN", "Random event"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "EVEN",     "Random event"
               ))
  
  expect_equal(FAMILY_EVENT_STRUCTURE("MARR", 
                                      family_event_details = FAMILY_EVENT_DETAIL(wife_age_at_event = "20y")),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "MARR",     "Y",
                               1, "WIFE",     "",
                               2, "AGE",   "20y"
               ))
})


test_that("Function INDIVIDUAL_ATTRIBUTE_STRUCTURE() @ L483", {
  expect_error(INDIVIDUAL_ATTRIBUTE_STRUCTURE())
  expect_error(INDIVIDUAL_ATTRIBUTE_STRUCTURE("TEST"))
  expect_error(INDIVIDUAL_ATTRIBUTE_STRUCTURE("FACT"))
  expect_error(INDIVIDUAL_ATTRIBUTE_STRUCTURE(c("FACT", "EDUC"), "This is a fact"))
  expect_error(INDIVIDUAL_ATTRIBUTE_STRUCTURE("FACT", "This is a fact"))
  expect_error(INDIVIDUAL_ATTRIBUTE_STRUCTURE("IDNO", 123456))
  
  expect_equal(INDIVIDUAL_ATTRIBUTE_STRUCTURE("NATI", "British"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "NATI",     "British"
               ))
  
  expect_equal(INDIVIDUAL_ATTRIBUTE_STRUCTURE("NATI", "British", INDIVIDUAL_EVENT_DETAIL(age = "0y")),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "NATI",     "British",
                               1,  "AGE",           "0y"
               ))
})


test_that("Function INDIVIDUAL_EVENT_DETAIL() @ L545", {
  expect_equal(dim(INDIVIDUAL_EVENT_DETAIL()), c(0, 3))  
  
  expect_equal(INDIVIDUAL_EVENT_DETAIL(age = "5y"),
               tibble::tribble(~level,  ~tag, ~value,
                               0, "AGE",    "5y"
               ))
})


test_that("Function INDIVIDUAL_EVENT_STRUCTURE() @ L596", {
  expect_error(INDIVIDUAL_EVENT_STRUCTURE())
  expect_error(INDIVIDUAL_EVENT_STRUCTURE("BLAH"))
  expect_error(INDIVIDUAL_EVENT_STRUCTURE("ADOP", adopted_by_which_parent = "WHO"))
  
  expect_equal(INDIVIDUAL_EVENT_STRUCTURE("BIRT"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "BIRT",    "Y"
               ))
  
  expect_equal(INDIVIDUAL_EVENT_STRUCTURE("CHRA"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "CHRA",     ""
               ))
  
  expect_equal(INDIVIDUAL_EVENT_STRUCTURE("BIRT", xref_fam = "@F4@"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "BIRT",    "Y",
                               1, "FAMC", "@F4@"
               ))
  
  expect_equal(INDIVIDUAL_EVENT_STRUCTURE("ADOP", xref_fam = "@F4@", adopted_by_which_parent = "BOTH"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "ADOP",     "",
                               1, "FAMC", "@F4@",
                               2, "ADOP", "BOTH"
               ))
})


test_that("Function MULTIMEDIA_LINK() @ L667", {
  expect_error(MULTIMEDIA_LINK("ref"))
  expect_error(MULTIMEDIA_LINK(multimedia_file_reference = "ref", source_media_type = "carrier pigeon"))
  expect_error(MULTIMEDIA_LINK(multimedia_file_reference = "ref", multimedia_format = "jpeg"))
  
  expect_equal(MULTIMEDIA_LINK("@M1@"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "OBJE", "@M1@"
               ))
  
  expect_equal(MULTIMEDIA_LINK(multimedia_file_reference = "ref", multimedia_format = "jpg", 
                               source_media_type = "electronic"),
               tibble::tribble(~level,   ~tag,       ~value,
                               0, "OBJE",           "",
                               1, "FILE",        "ref",
                               2, "FORM",        "jpg",
                               3, "MEDI", "electronic"
               ))
})


test_that("Function NOTE_STRUCTURE() @ L753", {
  expect_error(NOTE_STRUCTURE(submitter_text = c("test1", "test2")))
  
  expect_equal(NOTE_STRUCTURE("@T1@"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "NOTE", "@T1@"
               ))
  
  expect_equal(NOTE_STRUCTURE(submitter_text = "test text"),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "NOTE", "test text"
               ))
  
  expect_equal(NOTE_STRUCTURE(submitter_text = paste0(rep("a", 248), collapse="")),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "NOTE", paste0(rep("a", 248), collapse="")
               ))
  
  expect_equal(NOTE_STRUCTURE(submitter_text = paste0(rep("a", 249), collapse="")),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "NOTE", paste0(rep("a", 248), collapse=""),
                               1, "CONC", "a"
               ))
  
  expect_equal(NOTE_STRUCTURE(submitter_text = paste0(rep("a", 992), collapse="")),
               tibble::tribble(~level,   ~tag,      ~value,
                               0, "NOTE", paste0(rep("a", 248), collapse=""),
                               1, "CONC", paste0(rep("a", 248), collapse=""),
                               1, "CONC", paste0(rep("a", 248), collapse=""),
                               1, "CONC", paste0(rep("a", 248), collapse="")
               ))
})


test_that("Function PERSONAL_NAME_PIECES() @ L809", {
  expect_equal(dim(PERSONAL_NAME_PIECES()), c(0, 3))
  
  expect_equal(PERSONAL_NAME_PIECES(name_piece_prefix = "Mr", name_piece_nickname = "J"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "NPFX",   "Mr",
                               0, "NICK",    "J"
               ))
  
  expect_equal(PERSONAL_NAME_PIECES(name_piece_prefix = "Mr", name_piece_nickname = "J",
                                    notes = list(NOTE_STRUCTURE(submitter_text = paste0(rep("a", 992), collapse="")),
                                                 NOTE_STRUCTURE(submitter_text = paste0(rep("b", 992), collapse="")))),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "NPFX",   "Mr",
                               0, "NICK",    "J",
                               0, "NOTE", paste0(rep("a", 248), collapse=""),
                               1, "CONC", paste0(rep("a", 248), collapse=""),
                               1, "CONC", paste0(rep("a", 248), collapse=""),
                               1, "CONC", paste0(rep("a", 248), collapse=""),
                               0, "NOTE", paste0(rep("b", 248), collapse=""),
                               1, "CONC", paste0(rep("b", 248), collapse=""),
                               1, "CONC", paste0(rep("b", 248), collapse=""),
                               1, "CONC", paste0(rep("b", 248), collapse="")
               ))
})


test_that("Function PERSONAL_NAME_STRUCTURE() @ L909", {
  expect_error(PERSONAL_NAME_STRUCTURE())
  expect_error(
    PERSONAL_NAME_STRUCTURE("Joe Bloggs", 
                            name_phonetic_variation = c("Joe Blogs", "Jo Bloggs"))
  )
  expect_error(
    PERSONAL_NAME_STRUCTURE("Joe Bloggs", 
                            name_phonetic_variation = c("Joe Blogs", "Jo Bloggs"),
                            phonetic_type = "Can't spell")
  )
  expect_error(
    PERSONAL_NAME_STRUCTURE("Joe Bloggs", 
                            name_phonetic_variation = c("Joe Blogs", "Jo Bloggs"),
                            phonetic_type = c("Can't spell", "Can't spell"),
                            phonetic_name_pieces = list(PERSONAL_NAME_PIECES(name_piece_given = "Joe", 
                                                                             name_piece_surname = "Blogs")))
  )
  
  expect_equal(PERSONAL_NAME_STRUCTURE("Joe /Bloggs/", 
                                       name_pieces = PERSONAL_NAME_PIECES(name_piece_prefix = "Mr",
                                                                          name_piece_surname = "Bloggs")),
               tibble::tribble(~level,   ~tag,         ~value,
                               0, "NAME", "Joe /Bloggs/",
                               1, "NPFX",           "Mr",
                               1, "SURN",       "Bloggs"
               ))
  
  expect_equal(PERSONAL_NAME_STRUCTURE("Joe Bloggs", 
                                       name_phonetic_variation = c("Joe Blogs", "Jo Bloggs"),
                                       phonetic_type = c("Can't spell", "Can't spell")),
               tibble::tribble(~level,   ~tag,         ~value,
                               0, "NAME",   "Joe Bloggs",
                               1, "FONE",    "Joe Blogs",
                               2, "TYPE",  "Can't spell",
                               1, "FONE",    "Jo Bloggs",
                               2, "TYPE",  "Can't spell"
               ))
  
  expect_equal(PERSONAL_NAME_STRUCTURE("Joe Bloggs", 
                                       name_phonetic_variation = c("Joe Blogs", "Jo Bloggs"),
                                       phonetic_type = c("Can't spell", "Can't spell"),
                                       phonetic_name_pieces = 
                                         list(PERSONAL_NAME_PIECES(name_piece_given = "Joe", 
                                                                   name_piece_surname = "Blogs"),
                                              PERSONAL_NAME_PIECES(name_piece_given = "Jo",
                                                                   name_piece_surname = "Bloggs"))),
               tibble::tribble(~level,   ~tag,         ~value,
                               0, "NAME",   "Joe Bloggs",
                               1, "FONE",    "Joe Blogs",
                               2, "TYPE",  "Can't spell",
                               2, "GIVN",          "Joe",
                               2, "SURN",        "Blogs",
                               1, "FONE",    "Jo Bloggs",
                               2, "TYPE",  "Can't spell",
                               2, "GIVN",           "Jo",
                               2, "SURN",       "Bloggs"
               ))
})


test_that("Function PLACE_STRUCTURE() @ L1006", {
  expect_error(PLACE_STRUCTURE())
  expect_error(PLACE_STRUCTURE("Here", place_latitude = "N51.5", place_longitude = "E0.0"))
  expect_error(
    PLACE_STRUCTURE("London", 
                    place_phonetic_variation = c("Lundon", "Lundun"))
  )
  expect_error(
    PLACE_STRUCTURE("London", 
                    place_phonetic_variation = c("Lundon", "Lundun"),
                    phonetic_type = "English accent")
  )
  
  expect_equal(PLACE_STRUCTURE("Greenwich", 
                               place_phonetic_variation = c("Grenidge", "Grenich"),
                               phonetic_type = c("English accent", "English accent"),
                               place_latitude = "N51.5",
                               place_longitude = "E0.00"),
               tibble::tribble(~level,   ~tag,           ~value,
                               0, "PLAC",      "Greenwich",
                               1, "FONE",       "Grenidge",
                               2, "TYPE", "English accent",
                               1, "FONE",        "Grenich",
                               2, "TYPE", "English accent",
                               1,  "MAP",               "",
                               2, "LATI",          "N51.5",
                               2, "LONG",           "E0.00"
               ))
})


test_that("Function SOURCE_CITATION() @ L1103", {
  expect_equal(SOURCE_CITATION("@S1@"),
               tibble::tribble(
                 ~level,   ~tag, ~value,
                 0, "SOUR", "@S1@"
               ))
  
  expect_equal(SOURCE_CITATION("@S1@", where_within_source = 3, event_type_cited_from = "event"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "SOUR",  "@S1@",
                               1, "PAGE",     "3",
                               1, "EVEN", "event"
               ))
  
  expect_equal(SOURCE_CITATION("@S1@", where_within_source = 3, role_in_event = "a role"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "SOUR",  "@S1@",
                               1, "PAGE",     "3"
               ))
  
  expect_equal(SOURCE_CITATION("@S1@", where_within_source = 3, 
                               event_type_cited_from = "event", 
                               role_in_event = "a role"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "SOUR",   "@S1@",
                               1, "PAGE",      "3",
                               1, "EVEN",  "event",
                               2, "ROLE", "a role"
               ))
})


test_that("Function SOURCE_REPOSITORY_CITATION() @ L1182", {
  expect_error(SOURCE_REPOSITORY_CITATION())
  expect_error(SOURCE_REPOSITORY_CITATION("@R1@", source_media_type = "carrier pigeon"))
  
  expect_equal(SOURCE_REPOSITORY_CITATION("@R1@", source_call_number = c("123", "456"), 
                                          source_media_type = "map"),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "REPO", "@R1@",
                               1, "CALN",  "123",
                               1, "CALN",  "456",
                               2, "MEDI",  "map"
               ))
})


test_that("Function SPOUSE_TO_FAMILY_LINK() @ L1219", {
  expect_error(SPOUSE_TO_FAMILY_LINK())
  
  expect_equal(SPOUSE_TO_FAMILY_LINK("@F2@", list(NOTE_STRUCTURE(submitter_text = "test"))),
               tibble::tribble(~level,   ~tag, ~value,
                               0, "FAMS", "@F2@",
                               1, "NOTE",  "test"
               ))
})

